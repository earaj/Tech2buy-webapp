<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paiement | TECH2BUY</title>
  <link href='https://fonts.googleapis.com/css?family=Barlow Semi Condensed' rel='stylesheet'>
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <link rel="stylesheet" href="commun.css" />
  <link rel="icon" type="image/x-icon" href="output-onlinepngtools 1.png" style="height: 20px; width: 30px;">
  <script src="/js/bootstrap.min.js"></script>
  <style>
    body,
        html {
            height: 100%;
            margin: 0;
            font-family: "Barlow Semi Condensed", sans-serif;
            background-image: linear-gradient(200deg,
                    rgba(171, 171, 171, 0.05) 0%,
                    rgba(171, 171, 171, 0.05) 23%,
                    rgba(90, 90, 90, 0.05) 23%,
                    rgba(90, 90, 90, 0.05) 48%,
                    rgba(65, 65, 65, 0.05) 48%,
                    rgba(65, 65, 65, 0.05) 61%,
                    rgba(232, 232, 232, 0.05) 61%,
                    rgba(232, 232, 232, 0.05) 100%),
                linear-gradient(126deg,
                    rgba(194, 194, 194, 0.05) 0%,
                    rgba(194, 194, 194, 0.05) 11%,
                    rgba(127, 127, 127, 0.05) 11%,
                    rgba(127, 127, 127, 0.05) 33%,
                    rgba(117, 117, 117, 0.05) 33%,
                    rgba(117, 117, 117, 0.05) 99%,
                    rgba(248, 248, 248, 0.05) 99%,
                    rgba(248, 248, 248, 0.05) 100%),
                linear-gradient(144deg,
                    rgba(64, 64, 64, 0.05) 0%,
                    rgba(64, 64, 64, 0.05) 33%,
                    rgba(211, 211, 211, 0.05) 33%,
                    rgba(211, 211, 211, 0.05) 50%,
                    rgba(53, 53, 53, 0.05) 50%,
                    rgba(53, 53, 53, 0.05) 75%,
                    rgba(144, 144, 144, 0.05) 75%,
                    rgba(144, 144, 144, 0.05) 100%),
                linear-gradient(329deg, rgb(146, 196, 255), rgb(146, 196, 255));
        }

        .payment-container {
            position: absolute;
            margin-top: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 75%;
            height: 70%;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        .scrollable-content {
            max-height: 500px;
            overflow-y: auto;
        }

        .btn-primary {
            border-radius: 20px;
            padding: 10px 20px;
            width: 100%;
            background-color: #007bff;
            border: none;
        }

        .checkout-summary {
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 10px;
        }

        footer {
            margin-top: 20px;
        }
  </style>
</head>
<header>
  <%- include("../partials/headTech2buy.ejs") %>
</header>
<body>
  <form method="POST" action="/payer">
    <div class="payment-container">
        <a href="./panier">
            <img src="../Images/BackArrowButton.png" height="45" alt="Back" class="btn link-secondary">
        </a>
        <label for="pageindex">Annuler la transaction</label>

        <div class="row">
            <div class="col-md-6 mb-4">
                <h4 class="mb-3">Adresse de facturation</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="prenom">Prénom</label>
                        <input type="text" class="form-control" id="prenom" placeholder="Entrez votre prénom"
                            value="<%= utilisateurs.prenom %>" required>
                        <div class="invalid-feedback">Le prénom est requis.</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="nom">Nom</label>
                        <input type="text" class="form-control" id="nom" placeholder="Entrez votre nom"
                            value="<%= utilisateurs.nom %>" required>
                        <div class="invalid-feedback">Le nom est requis.</div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="nom_utilisateur">Nom Utilisateur</label>
                    <input type="text" class="form-control" id="nom_utilisateur"
                        placeholder="Entrez votre nom d'utilisateur" value="<%= utilisateurs.nom_utilisateur %>"
                        required>
                    <div class="invalid-feedback">Votre nom d'utilisateur est requis.</div>
                </div>
                <div class="mb-3">
                    <label for="adresse_courriel">Courriel</label>
                    <input type="email" class="form-control" id="adresse_courriel"
                        placeholder="Entrez votre adresse courriel" value="<%= utilisateurs.adresse_courriel %>"
                        required>
                    <div class="invalid-feedback">Veuillez entrer une adresse courriel valide.</div>
                </div>
                <div class="mb-3">
                    <label for="address">Adresse</label>
                    <input type="text" class="form-control" id="address" placeholder="Entrez votre adresse"
                        value="<%= adresse_de_livraison.adresse %>" required>
                    <div class="invalid-feedback">L'adresse est requise.</div>
                </div>
                <div class="mb-3">
                    <label for="address2">Adresse 2</label>
                    <input type="text" class="form-control" id="address2" placeholder="Apartment ou suite">
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="Pays">Pays</label>
                        <input type="text" class="form-control" id="pays" placeholder="Entrez votre pays"
                            value="<%= adresse_de_livraison.pays %>" required>
                        <div class="invalid-feedback">Le Pays est requis.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="province">Province</label>
                        <input type="text" class="form-control" id="province" placeholder="Entrez votre province"
                            value="<%= adresse_de_livraison.province %>" required>
                        <div class="invalid-feedback">La province est requise.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="ville">Ville</label>
                        <input type="text" class="form-control" id="ville" placeholder="Entrez votre ville"
                            value="<%= adresse_de_livraison.ville %>" required>
                        <div class="invalid-feedback">La ville est requise.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="codepostale">Code Postal</label>
                        <input type="text" class="form-control" id="codepostale"
                            placeholder="Entrez votre code postal" value="<%= adresse_de_livraison.code_postal %>"
                            required>
                        <div class="invalid-feedback">Le code postal est requis.</div>
                    </div>
                </div>
            </div>

            <% panier.forEach(function(item, index) { %>
              <input type="hidden" name="items[<%= index %>][name]" value="<%= item.nom_produit %>">
              <input type="hidden" name="items[<%= index %>][sku]" value="<%= item.id_produit %>">
              <input type="hidden" name="items[<%= index %>][price]" value="<%= item.prix_unitaire %>">
              <input type="hidden" name="items[<%= index %>][currency]" value="CAD">
              <input type="hidden" name="items[<%= index %>][quantity]" value="<%= item.quantite %>">
              <% }) %>

            <div class="col-md-6 mb-4">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Votre panier</span>
                    <span class="badge badge-secondary badge-pill; text-muted"><%= panier.length %> produit(s) dans votre panier.</span>
                </h4>
                <div class="bg-light p-3 scrollable-content checkout-summary">
                    <h3 class="display-5 text-center" style="font-weight: bold;">Résumé de la commande</h3>
                    <% let prix_total=0; %>
                    <% if (panier && panier.length) { %>
                        <% panier.forEach(function(produit) { %>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <h4>
                                        <%= produit.nom_produit %>
                                    </h4>
                                    <% if (produit.quantite> 1) { %>
                                        <p>(x <%= produit.quantite %>)</p>
                                        <% } %>
                                        <p>
                                            <%= produit.prix_unitaire %>$
                                        </p>
                                </div>
                                <% prix_total +=produit.prix_unitaire * produit.quantite; %>
                            </div>
                            <% }) %>
                            <% } else { %>
                                <h3>On dirait que c'est vide !</h3>
                                <% } %>
                                <% if (panier && panier.length) { %>
                                    <h4>Prix total: <%= prix_total.toFixed(2) %>$</h4>
                                    <% } %>
                </div><br>
                <button class="btn btn-primary btn-lg checkout-button" type="submit">Continuer à payer avec Paypal</button>
            </div>

        </div>
        <footer class="my-5 pt-5 text-muted text-center text-small">
            <p class="mb-1">&copy; 2024 Tech2Buy</p>
        </footer>
    </div>
</form>
</body>
</html>